<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>picoQuery compliance test</title>
<script src="../../builder/0.2/build.php?build=5-ffff1fff"></script>
<script>

var p$ = $;
$ = undefined;
</script>
<script src="../../builder/0.2/build.php?build=0-ffff1fff"></script>
<script>
var pmin$ = $;
$ = undefined;
</script>
<script src="zepto.js"></script>
<script>
var z$ = $;
</script>
<script src="jquery-2.2.4.js"></script>
<script>
var j$ = $;
</script>
<script>
function runInAllFrameworks(fn) {
//  console.log('jQuery / zepto / picoQuery / picoQuery.min');

  // Swap to jQuery
  $ = j$;
  console.log('jQuery');
  fn.call();

  // Swap to zepto
  $ = z$;
  console.log('zepto');
  fn.call();

  // Swap to picoQuery
  $ = p$;
  console.log('picoQuery');
  fn.call();

  // Swap to picoQuery optimized and minified
  $ = pmin$;
  console.log('picoQuery min');
  fn.call();

}

window.testNumber = 0;
function testInAllFrameworks(code,fn) {
//  console.log('jQuery / zepto / picoQuery / picoQuery.min');

  var testResults = [];
  var frameworks = [j$, z$, p$, pmin$];

  frameworks.forEach(function (framework) {
    var result;
    $ = framework;

    try {
//      result = fn.call();
      eval("result = " + code);
    }
    catch (e) {
      result = e;
      console.log(e);
    }
    testResults.push(result);
  });

  $ = j$;

  function toPrint(obj) {
    switch (typeof obj) {
      case 'object':
        var html = '';
        if (obj === null) {
          return 'null';
        }
        var className = obj.constructor.toString().match(/function (\w*)/)[1];
        if ((className == 'DOMException') || (className == 'TypeError')) {
          html = '<span class="error" title="' + (obj['message'] ? obj.message : '') + '">' + obj.name + '<span>';
        }
        else if (className.match('^HTML[^E]*Element')) {
          // Its an HTML Element
          html = '<span class="tagname" title="' + className + '">' + obj.tagName.toLowerCase() + '</span>';
          if (obj.id) {
            html += '<span class="tagid">#' + obj.id + '</span>';
          }
          else if (obj.className) {
            html += '<span class="tagclassname">.' + obj.className + '</span>';
          }
        }
        else if (obj.splice) {
          // Its an array (this is the same test as console.log performs)
          var content = [];
          for (var i=0; i<obj.length; i++) {
            content.push(toPrint(obj[i]));
          }
          html = '<span class="array">[ ' + content.join(', ') + ' ]</span>';
          if (obj.ready) {
            
          }
          html = '$' + html;
        }
        else {
          html = className;
        }
        return html;
      default:
        return '<span class="value">' + JSON.stringify(obj) + '</span>';
    }
  }
  var tdContent = testResults.map(function(item) {
//    return '';
    var output = '';
    for (var p in item) {
      output += p + ': ' + item[p]+'; ';
    }

//    return '<td>' + output + '</td>';
//    console.log(item);
    return toPrint(item);
  });

  function htmlEscape(str) {
      return str
          .replace(/&/g, '&amp;')
          .replace(/"/g, '&quot;')
          .replace(/'/g, '&#39;')
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;');
  }

  window.testNumber++;
  var tr = '<tr>';
  tr += '<td>' + window.testNumber + '</td>';
  tr += '<td><div class="code" title="' + htmlEscape(code) + '">' + htmlEscape(code) + '</div></td>';
  for (var i=0; i<tdContent.length; i++) {
    tr += '<td' + ((tdContent[0] != tdContent[i]) ? ' class="mismatch"' : '') + '>' + tdContent[i] + '</td>';
  }
  tr += '</tr>';
  // TODO: red backgrounds if td[2] != td[1]    
  $('#testresults tbody').append(tr);
//  console.log('Test #' + window.testNumber);
//  console.log(testResults);
}

function group(caption) {
  $('#testresults tbody').append('<tr class="group"><th colspan=6>' + caption + '</th></tr>');  
  $('#testresults tbody').append('<tr><th>#</th><th>Code</th><th>jQuery 1.9.1 (ref)</th><th>zepto 1.2.0</th><th>picoQuery 0.2</th><th>picoQuery.min</th></tr>');
}

function subgroup(caption) {
  $('#testresults tbody').append('<tr class="subgroup"><th colspan=6>' + caption + '</th></tr>');  
}

$(function() {
  
//  alert('ready');
//  $('span').filter(':nth-of-type(odd)').addClass('red-text');

//  $('span').filter($('span:nth-of-type(odd)')).addClass('red-text');
//  $('span').filter('*').addClass('red-text');

/*
  runInAllFrameworks('$(1)', function() {
    console.log($(document).parent());      // ok
    console.log($([document]));             // ok
    console.log($([document, null]));       // zepto fails to comply (it removes the null value)
    console.log($([document, undefined]));  // zepto fails to comply (it removes the undefined value)
    console.log($(1));                      // zepto fails to comply
//    console.log($([1, 2]).first());         // zepto fails to comply, it returns '1', but it should be wrapped
  });
*/

//    console.log($([document, null]));       // zepto fails to comply (it removes the null value)
//  testInAllFrameworks('$([document, null])', function() {return $([document, null])});
//eval('alert("hej")');

/*
ok in all:
  testInAllFrameworks('$([document])', function() {return $([document]);});
  testInAllFrameworks('$("*")', function() {return $("*");});

*/


  group('constructor');
  testInAllFrameworks('$([document, null])');
  testInAllFrameworks('$(null)');
  testInAllFrameworks('$(0)');
  testInAllFrameworks('$(1)');
  testInAllFrameworks('$(false)');
  testInAllFrameworks('$("")');
  testInAllFrameworks('$(undefined)');
  testInAllFrameworks('$([])');
  testInAllFrameworks('$("a string")');
  testInAllFrameworks('$(true)');
  testInAllFrameworks('$([3,4])');
  testInAllFrameworks('$("<div class=div1/><div class=div2/>")');
  testInAllFrameworks('$($("<div>text</div>").get(0).childNodes)');
  testInAllFrameworks('$($("<div>text</div>").get(0).childNodes[0])');
  testInAllFrameworks('$("<div/>")');
  testInAllFrameworks('$("<li id=one>1</li><li id=two>2</li>")');
  testInAllFrameworks('$("li", $("ul"))');
  testInAllFrameworks('$("li", $("ul").get())');
  testInAllFrameworks('$("li", $("ul").get(0))');
  testInAllFrameworks('$("ul > li:first-child")');
  testInAllFrameworks('$([$("#item3").get()])');
  testInAllFrameworks('$([$("#item3").get(0)])');
  testInAllFrameworks('$("#item3").get()');
  testInAllFrameworks('$("#item3").get(0)');
  testInAllFrameworks('$("li", $("#item3").get())');
  testInAllFrameworks('$("li", $("#item3").get(0))');
  testInAllFrameworks('$("ul li:odd")');
  testInAllFrameworks('$("<li><a></a></li>").children("a").end()'); // pushstack. Every traversal method creates a new jQuery set and builds a stack. Use .end() to get at the previous set.

  // Document Fragment
  testInAllFrameworks('function() {var li=document.createElement("li");var frag=document.createDocumentFragment();frag.appendChild(li);return $(frag)}()'); 

  testInAllFrameworks('$($("li"))');        // selector is a jQuery object
  testInAllFrameworks('$("li#item1", $("ul#ul2").get(0))');     // selector is not in the decendant tree
  testInAllFrameworks('$("li#item1", $("ul#ul2"))');            // selector is not in the decendant tree

  testInAllFrameworks('$($("li#item1").get(0), $("ul#ul2").get(0))');    // selector is Element, and we have context (which is ignored)
  testInAllFrameworks('$($("li#item1"), $("ul#ul2").get(0))');    // selector is jQuery, and we have context (which is ignored)

/*



  group('.children()');
  testInAllFrameworks('$("ul").children()');
  testInAllFrameworks('$("ul").children(".odd")');

  group('.first()');
  testInAllFrameworks('$("ul li").first()');
  testInAllFrameworks('$("ul li").first(".odd")');
  testInAllFrameworks('$([3,4]).first()');
  testInAllFrameworks('$([3,4]).first()');
  testInAllFrameworks('$("ul.notexist").first()');
  testInAllFrameworks('$(null).first()');
  testInAllFrameworks('$(true).first()');

  group('.next()');
  testInAllFrameworks('$("li:first-child").next()');
  testInAllFrameworks('$("li:last-child").next()');

  group('.prev()');
  testInAllFrameworks('$("li:last-child").prev()');
  testInAllFrameworks('$("li:first-child").prev()');

  group('.parent()');
  testInAllFrameworks('$("li#item3_2").parent()');
  testInAllFrameworks('$("li").parent()');
  testInAllFrameworks('$(document).parent()');
  testInAllFrameworks('$(document).parent().parent()');
  testInAllFrameworks('$(1).parent()');
  testInAllFrameworks('$([3,4]).parent()');

  group('.map()');
  testInAllFrameworks('$("li").map(function(i,elm) {return elm})');
  testInAllFrameworks('$("li").map(function(i) {return i})');
  testInAllFrameworks('$("li").map(function(i) {return this})');
  testInAllFrameworks('$([3,4]).map(function(i) {return i})');
  testInAllFrameworks('$([3,4]).map(function(i,elm) {return elm})');
  testInAllFrameworks('$("li").map()');

  group('.each()');
  testInAllFrameworks('function(){var sum=0;$("li").each(function(i) {sum+=i});return sum}()');
  testInAllFrameworks('function(){var els=[];$("li").each(function(i) {els.push(this)});return els}()');
  testInAllFrameworks('function(){var els=[];$("li").each(function(i,el) {els.push(el)});return els}()');
  testInAllFrameworks('function(){var els=[];$([3,4]).each(function(i,el) {els.push(el)});return els}()');

  group('.get()');
  testInAllFrameworks('$("li").get(0)');
  testInAllFrameworks('$("li").get()');
  testInAllFrameworks('$("li.noexist").get()');
  testInAllFrameworks('$("li.noexist").get(0)');
  testInAllFrameworks('$([0,1]).get(0)');
  testInAllFrameworks('$(14).get(0)');
  testInAllFrameworks('$("<div/>").get(0)');

  group('.css(property)');
  testInAllFrameworks('$("li.odd").css("font-style")');
  testInAllFrameworks('$("li.odd").css("fontStyle")');
  testInAllFrameworks('$("li#item2").css("font-style")');
  testInAllFrameworks('$("li#item2").css("fontStyle")');
  testInAllFrameworks('$("li#item2_1").css("font-style")');
  testInAllFrameworks('$("li#item2_1").css("fontStyle")');
  testInAllFrameworks('$("li#item4").css("font-style")');
  testInAllFrameworks('$("li#item4").css("fontStyle")');
  testInAllFrameworks('$("<div style=\'float:left\'/>").css("float")');
  testInAllFrameworks('$("<div style=\'float:left\'/>").css("cssFloat")');
  testInAllFrameworks('$().css("fontStyle")');
  testInAllFrameworks('$("li#item4").css("font-size")');
  testInAllFrameworks('$("li#item4").css("width")');

  group('.css(property, value)');
  testInAllFrameworks('$("<div/>").css("font-style", "italic").css("font-style")');
  testInAllFrameworks('$("<div/>").css("fontStyle", "italic").css("font-style")');
  testInAllFrameworks('$("<div/>").css("user-select", "none").css("user-select")');
  testInAllFrameworks('$("<div/>").css("font-size", "10").css("font-size")');
  testInAllFrameworks('$("<div/>").css("width", "123").css("width")');

  testInAllFrameworks('$("<div class=italic/>").css("font-style", "normal").css("font-style")');
  testInAllFrameworks('$("<div class=italic/>").css("fontStyle", "normal").css("font-style")');
  testInAllFrameworks('$("<div/>").css("cssText", "color:blue;font-size:16px").css("font-size")');
//  testInAllFrameworks('$("li").css("font-decoration", "underline")');
//  testInAllFrameworks('$("li").css("font-decoration", "underline")');
// TODO: add testing of cssHooks
  // Visual insection:
  //p$("li").css("text-decoration", "underline"); //  - ok
  // p$("li").css("textDecoration", "underline"); - ok
  // p$("li").css("cssText", "color:blue; text-decoration:underline"); // ok

//  p$("li").css("-moz-user-select", "none");
//  p$("li").css("width", 124);


  group('.addClass( className )');
  testInAllFrameworks('$("<div/>").addClass("test").get(0).className');
  testInAllFrameworks('$("<div/>").addClass("test").addClass("test2").get(0).className');
  testInAllFrameworks('$("<div/>").addClass("test ").get(0).className');
  testInAllFrameworks('$("<div/>").addClass("test2 test2").get(0).className');
  testInAllFrameworks('$("<div/>").addClass("test2").addClass("test2").get(0).className');
  testInAllFrameworks('$("<div/>").addClass(" ").get(0).className');
  testInAllFrameworks('$("<div/>").addClass("\t").get(0).className');
  testInAllFrameworks('$("<div class=\ttest/>").addClass("t2").get(0).className');
  testInAllFrameworks('$("<div class=\'a b\'/>").addClass(function(a,b){return "b"+a+b}).get(0).className');
  testInAllFrameworks('$($("<div>text</div>").get(0).childNodes[0]).addClass("t").get(0).className');

  group('.removeClass( className )');
  testInAllFrameworks('$("<div class=\'test\'/>").removeClass("test").get(0).className');
  testInAllFrameworks('$("<div class=\'a b\'/>").removeClass("b").get(0).className');
  testInAllFrameworks('$("<div class=\'a b c\'/>").removeClass("b").get(0).className');
  testInAllFrameworks('$("<div class=\'b b c\'/>").removeClass("b").get(0).className');

  // remove multiple classes
  testInAllFrameworks('$("<div class=\'a b c\'/>").removeClass("a b").get(0).className');
  testInAllFrameworks('$("<div class=\'a b c\'/>").removeClass("a c").get(0).className');
  testInAllFrameworks('$("<div class=\'a b c d\'/>").removeClass("b c").get(0).className');
  testInAllFrameworks('$("<div class=\'a elephant\'/>").removeClass("phant").get(0).className');

  group('.removeClass()');
  testInAllFrameworks('$("<div class=\'test test2\'/>").removeClass()');
  testInAllFrameworks('$("<div class=\'test test2\'></div><div class=\'test test2\'></div>").removeClass()');

  group('.removeClass( function )');
  testInAllFrameworks('$("<div class=\'a b c\'></div>").removeClass(function(index,currentClassName){return "b"})'); 



//elephant


 $1subgroup('.next()');
  testInAllFrameworks('$("li:first-child").next()');
  testInAllFrameworks('$("li:last-child").next()');
*/
  group('.attr()');
  testInAllFrameworks('$("li:first-child").attr("class")');
  testInAllFrameworks('$("li:first-child").attr("class2")');

  // Try to get attr on a Text node
  testInAllFrameworks('$($("li:first-child").get(0).firstChild).attr("class")'); 

  // Try to get attr on a Document node
  testInAllFrameworks('$(document).attr("class")'); 

  // Try to get attr on a Document node
  testInAllFrameworks('function(){document.setAttribute("class", "test"); return $(document).attr("class")}()'); 

  // Try to get attr on a node created in a document fragment
  testInAllFrameworks('function() {var li=document.createElement("li");li.setAttribute("class","odd"); var frag=document.createDocumentFragment();frag.appendChild(li);return $(frag.firstChild)}().attr("class")'); 

  // Try to get attr on a document fragment
  testInAllFrameworks('function() {var frag=document.createDocumentFragment();frag.setAttribute("class","odd");return $(frag)}().attr("class")'); 

  testInAllFrameworks('$("<div/>").attr("class", "italic")'); 
  testInAllFrameworks('$("<div/>").attr("class", null)'); 
  testInAllFrameworks('$("<div/>").attr("class", "italic").attr("class", null)'); 
  testInAllFrameworks('$("<div/>").attr("class", function(){return "test"})'); 
  testInAllFrameworks('$("<div class=oldval></div><div class=test></div><div></div>").attr("class", function(i,oldVal){return oldVal+i})'); 


  group('.removeAttr()');
  subgroup('.removeAttr( className )');
  testInAllFrameworks('$("<div class=test></div>").removeAttr("class")');
  testInAllFrameworks('$("<div class=test id=test></div>").removeAttr("class id")');
  testInAllFrameworks('$().removeAttr("class")');
  subgroup('.removeAttr()');
  testInAllFrameworks('$("<div class=test></div>").removeAttr()');
  subgroup('.removeAttr( function )');
  subgroup('edge cases');
  testInAllFrameworks('$("<div class=test></div>").removeAttr(null)');

  //alert('my elephant is blue'.replace(new RegExp('elephant\\s', "g"), ""));

  group('.empty()');
  subgroup('.empty()');
//  p$('li').empty();
  testInAllFrameworks('$("<li>1</li><li>2</li>").empty()'); 
  testInAllFrameworks('$("<li>1</li><li>2</li>").empty().children()'); 

  // ============== html() ===============
  group('.html()');
  subgroup('.html()');
  testInAllFrameworks('$("li").html()'); 
  testInAllFrameworks('$().html()'); 
  subgroup('.html( htmlString )');
  testInAllFrameworks('$("<ul></ul><ul></ul>").html("<li>item</li>").html()'); 
  subgroup('.html( function )');
  testInAllFrameworks('$("<div>old</div>").html(function(i,oldVal){return "oldval:"+oldVal+",index:"+i}).html()'); 

  // ============== find() ===============
  group('find()');
  subgroup('.find( selector[String] )');
  testInAllFrameworks('$("ul").find("li")'); 
  testInAllFrameworks('$("ul#ul0").find("li")'); 
  testInAllFrameworks('$("ul#ul2").find("li")'); 
  testInAllFrameworks('$("ul#ul2,ul#ul3").find("li")'); 

  testInAllFrameworks('$("ul#ul2").find("li#item1")');            // selector is not in the decendant tree

  subgroup('.find( selector[jQuery] )');
  testInAllFrameworks('$("ul").find($("li.odd"))'); // selector is jQuery object
  testInAllFrameworks('$("ul#ul2,ul#ul3").find($("li"))'); 
  testInAllFrameworks('$("ul#ul2").find($("li#item1"))');         // selector is a jQuery object NOT in the decendant tree

  subgroup('.find( selector[Element] )');
  testInAllFrameworks('$("ul#ul2").find($("li#item1").get(0))');  // selector is an Element NOT in the decendant tree
  testInAllFrameworks('$("ul#ul2,ul#ul3").find($("li").get())'); 

//  testInAllFrameworks('$("ul#ul0").find($("li"))');  // selector is a jQuery object
//  testInAllFrameworks('$("ul#ul0").find($("li#item1"))');  // selector is a jQuery object
//  testInAllFrameworks('$("ul#ul0").find($("li#item1").get(0))');  // selector is an Element

});

</script>

<style>
table#testresults {border-collapse: collapse}
tr.group {background-color:#aaaaee; line-height:2.4em; }
tr.group th {font-style: normal; font-weight: bold; letter-spacing: 2px; text-align: center; padding-left: 0px} /*  text-transform: uppercase; */
tr.subgroup {background-color:#dddddd; line-height:1.4em;}
tr.subgroup th {text-align: center; padding-left: 0px}

tr th {font-style: italic; font-weight: normal}
td,th {vertical-align:top; border: 1px solid black;}
td {background-color:white}
td:nth-child(n+4) {background-color:#bbffbb}
td.mismatch {background-color: #ffbbbb}
.code {width:300px;overflow:hidden;text-overflow: ellipsis; white-space:nowrap;}
.array {}
.tagname {color: blue;}
.tagid {color: darkblue;}
.value {color: blue;}
.erro {color: red;}

.italic {
  font-style: italic;  
}
li.odd {
  font-style: italic;
}
</style>
</head>

<body>
<h3>Comparison of the result of the same code executed in each framework</h3>
<table id="testresults">
  <tbody>
  </tbody>
</table>
<p>You can also view the console for the same output</p>

<div id="test">
  <ul id="ul0">
    <li id="item1" class="odd">item 1</li>
    <li id="item2" style="font-style:italic">item 2
      <ul id="ul2">
        <li id="item2_1">item 2.1</li>
      </ul>
    </li>
    <li id="item3" class="odd">item 3
      <ul id="ul3">
        <li id="item3_1">item 3.1</li>
        <li id="item3_2">item 3.2</li>
      </ul>
    </li>
    <li id="item4">item 4</li>
  </ul>
</div>
</body>
</html>
